---
emoji: π€
title: 01. Terraform - λ™μ‘ κ³Όμ •
date: '2023-08-25 01:00:00'
author: μ •μ±ν„
tags: terraform
categories: terraform
---



## Terraform λ™μ‘ν•λ” κ³Όμ •

 Terraformμ€ μ‚¬μ©μκ°€ μ‘μ„±ν• μ½”λ“λ¥Ό κ° CSP(Cloud Solution Provide)λ“¤μ APIκ°€ μ½μ„ μ μλ„λ΅ λ³€ν™ν•κ³  μ½”λ“μ— μ΄μƒμ΄ μ—†λ”μ§€ κ³„νλ¥Ό μ‹¤ν–‰ν•κ³  μ‹¤μ  μ‚¬μ©μ κ³„μ •μ— μΈν”„λΌλ¥Ό μ μ©μ„ ν•λ‹¤.

>μ—¬κΈ°μ„ μ¤‘μ”ν• μ μ€ APIμ— μ ‘κ·Ό ν•  μ μλ”μ§€κ°€ μ¤‘μ”ν•λ‹¤.
κ°„νΉ Terraformκ°λ° μ„λ²„(?)λ¥Ό Cloud Private ν™κ²½μ— κµ¬μ„±ν–μ„ κ²½μ° Initκ³Όμ •μ΄ λμ§€ μ•λ”λ‹¤. (Planκ³Ό Applyλ” λλ‹¤)

---

### - Flow

[](https://velog.velcdn.com/images/jtret2424/post/314311aa-526e-4dfb-84c4-aaeafe92f6de/image.png)

[](https://velog.velcdn.com/images/jtret2424/post/80d5d6c3-378d-481f-ace7-494c5177a19a/image.png)

![](https://velog.velcdn.com/images/jtret2424/post/8b55ef91-c33e-482a-ac90-269d7fbd1718/image.png)

μ½”λ“λ¥Ό μ‘μ„±**(Write)**ν•κ³  terraformμ΄ λ””λ ‰ν† λ¦¬λ¥Ό λ³΄κ³  μ΄κΈ°ν™”**(Init)**ν•κ³  κ³„νμ„ μ‹¤ν–‰**(Plan)**ν•κ³  μΈν”„λΌ μ μ©**(Apply)**ν•λ‹¤.

---
### 1-1. Write(μ‘μ„±)


μ‹¤μ  ν”„λ΅λΉ„μ €λ‹ ν•κΈ° μ„ν•΄μ„λ” μ½”λ“ μ‘μ„±μ΄ ν•„μ”ν•κ³  Terraformμ νΉμ§•μΌλ΅λ” Yamlκ³Ό κ°™μ΄ ```Key```μ™€ ```Value``` ν•νƒλΌμ„ μ‘μ„±ν•κΈ° νΈν•λ‹¤. 

μ•„λ μ½”λ“λ§ λ΄λ„ ```Key```μ™€ ```Value``` ν•νƒλ΅ μ΄λ£¨μ–΄μ Έ μμ–΄μ„ ν•λμ— μ•μ•„λ³Όμ μλ‹¤.

~~(μ‚¬μ‹¤ module, variable, locals λ“± μ•κ² λ ν…λ° μ½”λ“λ‘ μΉν•μ§€ μ•μ€ μ‚¬λλ“¤μ΄λΌλ©΄ "μ—¥?γ…‡γ……γ…‡" ν•  μλ„ μλ‹¤... λ‚λ” moduleμ—μ„ νλ“¤μ—λ‹¤..)~~


```
#VPC μƒμ„± μμ 

provider "aws" {
  region = "ap-northeast-2"
}

resource "aws_vpc" "vpc" {
    cidr_block = "10.150.0.0/16"
    
    tags = {
        Name = "my-test-vpc"
    }
}
```
>Terraformμ€ μ‘μ„±ν• μ½”λ“λ¥Ό μ‹¤ν–‰ν• λ•μ— λ§λ“¤μ–΄μ§€λ” λ¦¬μ†μ¤μ μμ„κ°€ μ‘μ„±ν• μμ„κ°€ μ•„λ‹ λ³„λ„μ λ°©μ‹μ΄ μλ‹¤.
>
>μλ΅ Securtiy groupsμ΄ λ¨Όμ € λ§λ“¤μ–΄μ§€κ³  EC2μƒμ„± λλ‹¤.
μ΄λ ‡κ² μ°λ¦¬κ°€ μ½”λ“λ¥Ό μ‘μ„±ν• λ• κ³ λ ¤ν•μ§€ μ•μ•„λ„ Terraformμ€ μΉμ ν•κ² μ•μ•„μ„ μμ„λ€λ΅ μƒμ„±μ΄ λλ‹¤.

---

### 1-2. Init(μ΄κΈ°ν™”)

Terraformμ—μ„λ” ```inti``` λ¥Ό μ΄κΈ°ν™” κ³Όμ •μ΄λΌκ³  ν•λ‹¤.

μ°λ¦¬λ” write κ³Όμ •μ—μ„ μ½”λ“λ¥Ό μ‘μ„±ν•κ³  ```terraform init``` λ…λ Ήμ„ ν†µν•΄ μ΄κΈ°ν™”λ¥Ό ν•΄μ•Όν•λ‹¤.

μ—¬κΈ°μ„ μ΄κΈ°ν™”λ€, Terraform κµ¬μ„± νμΌμ΄ μ‘μ—…λ λ””λ ‰ν† λ¦¬ λ‹¤μ‹ μ½λ” κ³Όμ •μ΄κ³ 
λ””λ ‰ν† λ¦¬μ— μλ” ```.tf``` νμΌμ„ λ΅λ“ν•κ³  ```provider```μ™€ ```module```μ„ μ‹λ³„ν•κ³  λ‹¤μ΄λ΅λ“ μ§„ν–‰ν•λ‹¤.

ν•„μλ΅ ```plugin μ„¤μΉ```, ```Module μ„¤μΉ```, ```Backend μ΄κΈ°ν™”``` κ³Όμ •μ΄ μλ‹¤λ©΄ init κ³Όμ •μ΄ ν•„μ”ν•λ‹¤.


![](https://velog.velcdn.com/images/jtret2424/post/130b9e5f-b706-446c-bb44-65d8a5366f79/image.gif)
```init``` κ³Όμ •μ΄ μ™„λ£κ°€ λλ©΄ μ½”λ“κ°€ μ‘μ„±λ λ””λ ‰ν† λ¦¬μ— ```.terraform.lock.hcl``` νμΌμ΄ λ§λ“¤μ–΄ μ§„λ‹¤.


---

### 1-3. Plan(κ³„ν)

```plan```μ€ μ‘μ„±ν• μ½”λ“λ¥Ό μ μ©ν•  μΈν”„λΌμ— ```κ³„ν μ‹¤ν–‰```ν•λ” κ³Όμ •μ΄λ©° μ‹¤μ λ΅ μ–΄λ–¤ λ¦¬μ†μ¤λ“¤μ΄ ```μƒμ„±, λ³€κ²½, μ‚­μ ```κ°€ λλ”μ§€ ν™•μΈν•λ” μ μ°¨λ‹¤.


![](https://velog.velcdn.com/images/jtret2424/post/270b0ffb-8c9f-4654-98f3-ebe2d46a828d/image.png)

μ΄λ ‡κ² ```terraform plan``` λ…λ Ήμ–΄λ¥Ό ν†µν•΄ Planμ μ •λ³΄λ¥Ό ν™•μΈ ν•  μ μκ³ 
1κ°μ λ¦¬μ†μ¤κ°€ μƒμ„±μ΄ λκ³ , 0κ°κ°€ λ³€κ²½μ΄ λκ³ , 0κ°κ°€ μ‚­μ λλ‹¤ λΌλ” κ²ƒμ„ ν™•μΈ ν•  μ μμµλ‹λ‹¤.
(```Plan : 1 to add, 0 to change, 0 to destroy```)

![](https://velog.velcdn.com/images/jtret2424/post/0e93249b-9092-4179-929b-4806602863cd/image.png)

μ‚¬μ‹¤ ```plan```λ¥Ό ν•μ§€ μ•κ³  λ°”λ΅ ```apply```λ¥Ό μ§„ν–‰ν•  μ μμµλ‹λ‹¤λ§.. μ„ μ²λΌ μ‚¬λμ€ μ‹¤μλ¥Ό ν•κΈ°μ— ```plan```μ€ μ¤‘μ”ν•©λ‹λ‹¤.

κ·Έλ¦¬κ³  terraformμ—μ„λ” μ–΄λ””κ°€ μλ»λμ—λ”μ§€ ν™•μ‹¤ν μ•λ ¤μ£ΌκΈ° λ•λ¬Έμ— μ—λ¬λ΅ κ³ μƒν•  μΌμ΄ μ μµλ‹λ‹¤.
~~(μ λ‹¤κ³  ν–μ§€ μ—†λ‹¤κ³  ν•μ§„ μ•μ•λ”°...)~~

---

### 1-4. Apply(μ μ©)

```apply```λ” μ½”λ“λ¥Ό μ‹¤μ  μΈν”„λΌμ— μ μ©ν•κΈ° μ„ν•΄ μ‚¬μ©ν•©λ‹λ‹¤.

μ°λ¦¬λ” μ΄μ „μ— ```plan```λ¥Ό ν†µν•΄ κ³„νμ„ μ‹¤ν–‰ν•μ€μΌλ©° μ‹¤ν–‰ κ³Όμ • μ¤‘ μ½”λ“κ°€ μλ” λ””λ ‰ν† λ¦¬μ— ```terraform``` λ””λ ‰ν† λ¦¬κ°€ μƒμ„±λμ—μµλ‹λ‹¤. 

![](https://velog.velcdn.com/images/jtret2424/post/42be98d7-b30c-4f23-bed8-5c650b1004e9/image.png)

μ €μ¥λ ```terraform``` λ””λ ‰ν† λ¦¬μ•μ—λ” CSP APIμ™€ ν†µμ‹  κ°€λ¥ν•λ„λ΅ λ§λ“¤μ–΄μ§„ λ””λ ‰ν† λ¦¬κ°€ μμΌλ©° κµ¬μ„±λ νμΌμ„ κ°€μ§€κ³  μ μ©ν•κ²λ©λ‹λ‹¤.

![](https://velog.velcdn.com/images/jtret2424/post/9d8f6ca4-715f-4e96-a35a-ef0c92e6b70c/image.png)

```terraform apply``` λ…λ Ήμ–΄λ΅ μ μ© μ‹ ```Enter a value : ```   λ¬Έκµ¬κ°€ λ°μƒν•λ©° ν™•μΈ λ‹¨κ³„κ°€ ν•„μ”ν•©λ‹λ‹¤.
λ‹¤μ‹ ν•λ² μ μ© ν• κ»€μ§€ λ¬Όμ–΄λ΄…λ‹λ‹¤.  ```yes```λ¥Ό μ…λ ¥ν•κ² λλ©΄ μƒμ„±λλ” λ¦¬μ†μ¤μ ```ID``` κ°€ μ¶λ ¥λλ©΄μ„ ```Apply complete! Resources: 1 added, 0 changed, 0 destroyed.``` μ μ© μ™„λ£λμ—κ³  λ‡κ°μ λ¦¬μ†μ¤κ°€ μƒμ„±, λ³€κ²½, μ‚­μ  λμ—λ”μ§€λ¥Ό μ• μ μμµλ‹λ‹¤.

μ΄λ ‡κ² ```apply```λ¥Ό ν•κ²λλ©΄ μ½”λ“κ°€ μλ λ””λ ‰ν† λ¦¬μ—λ” ```terraform.tfstate```, ```terraform.tfstate.backup``` νμΌμ΄ μƒμ„±λμ—μµλ‹λ‹¤.

```terrafrom.tfstate```νμΌμ€ ```apply``` μ§ν›„μ μΈν”„λΌ μƒνƒλ¥Ό μ €μ¥ν•΄λ‘” νμΌμ΄λ©° ```terrafrom.tfstate.backup```νμΌμ€ ```apply``` μ΄μ „μ μƒνƒλ¥Ό μ €μ¥ν•΄λ‘” νμΌμ…λ‹λ‹¤.

---

### 1-5. Destroy

```destroy```λ” μ°λ¦¬κ°€ μ½”λ“λ΅ μƒμ„±ν• μΈν”„λΌλ¥Ό μ‚­μ ~~(λΏμ…”λΏμ…”!)~~ν•κΈ° μ„ν•΄ μ‚¬μ©ν•©λ‹λ‹¤.

![](https://velog.velcdn.com/images/jtret2424/post/7f4e1f21-5317-4f43-9569-6215e4616a61/image.png)

```terraform destroy```λ¥Ό ν†µν•΄ μ‚­μ  ν•  μ μμΌλ©° ```plan```κ³Ό ```apply```μ²λΌ μ–΄λ–¤ λ¦¬μ†μ¤κ°€ μ‚­μ λλ”μ§€,
μ •λ§λ΅ μ‚­μ  ν•  κ²ƒμΈμ§€(?) λ¬Όμ–΄λ³΄κ² λ©λ‹λ‹¤.

---

### - End..

μ΄λ ‡κ² μ°λ¦¬λ” μ½”λ“ μ‘μ„± λ‹¨κ³„λ¶€ν„° μ‚­μ  λ‹¨κ³„κΉμ§€μ Flowλ¥Ό μ•μ•„λ΄¤λ‹¤..

μ•μΌλ΅ μ½”λ“λ¥Ό μ‘μ„±ν•λ©΄μ„ Terraform documentμ„ λ§μ΄ λ³΄κ² λ ν…λ° μμ„Έν λ³΄λ©΄ μ—„μ²­λ‚ νμ΄ μ¨κ²¨μ Έ μλ‹¤!


κ·ΈλΌ.. ν…λΌνΌ κ³ μκ°€ λλ” λ‚ κΉμ§€.. ~~μ•„λ””μ¤μ¤..~~

![](https://velog.velcdn.com/images/jtret2424/post/c3713d77-cdf8-4542-8a34-1d418dd48990/image.gif)

Terraform languge document : https://www.terraform.io/language

---

**μλ¬Έκ³Ό λ§μ€ λ„μ›€μ„ μ£Όμ‹  vincentλ‹κ» κ°μ‚¬λ“λ¦½λ‹λ‹¤. ( _ _ ) 
**

```toc
```